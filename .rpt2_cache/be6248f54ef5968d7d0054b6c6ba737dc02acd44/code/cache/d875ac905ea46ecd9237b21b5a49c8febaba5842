{"code":"var ExtendedPropertiesSectionComponent_1;\r\nimport { __decorate, __metadata } from \"tslib\";\r\nimport { Component, forwardRef, Input } from '@angular/core';\r\nimport { FormControl, FormGroup, NG_VALUE_ACCESSOR } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { ExtendedPropertiesService } from '../service/extendedProperties.service';\r\nimport { UtilityService } from '../service/utility.service';\r\nlet ExtendedPropertiesSectionComponent = ExtendedPropertiesSectionComponent_1 = class ExtendedPropertiesSectionComponent {\r\n    constructor(router, utilityService, service, activatedRoute) {\r\n        this.router = router;\r\n        this.utilityService = utilityService;\r\n        this.service = service;\r\n        this.activatedRoute = activatedRoute;\r\n        this.pendingOnChangeEvents = new Array();\r\n        this.pendingHandled = false;\r\n        console.log('ExtendedPropertiesSectionComponent constructor');\r\n    }\r\n    get containerId() {\r\n        this.state = this.router.routerState.snapshot.url.split(\"/\")[2];\r\n        console.log(this.router.routerState.snapshot.url);\r\n        if (parseInt(this.state)) {\r\n            return this.companyId;\r\n        }\r\n        else {\r\n            return this.organizationId;\r\n        }\r\n    }\r\n    get containerType() {\r\n        this.state = this.router.routerState.snapshot.url.split(\"/\")[2];\r\n        if (parseInt(this.state)) {\r\n            return \"Company\";\r\n        }\r\n        else {\r\n            return \"Organization\";\r\n        }\r\n    }\r\n    ngOnInit() {\r\n        this.companyId = 1;\r\n        this.organizationId = 1;\r\n        console.log('ExtendedPropertiesSectionComponent OnInit');\r\n        this.service.getBySection(this.containerId, this.containerType, this.entityName, this.sectionName).subscribe(data => {\r\n            this.extendedProperties = data.sort((a, b) => {\r\n                if (a.itemOrder > b.itemOrder) {\r\n                    return +1;\r\n                }\r\n                if (a.itemOrder < b.itemOrder) {\r\n                    return -1;\r\n                }\r\n                return 0;\r\n            });\r\n            this.rows = this.getRows();\r\n            let group = {};\r\n            for (let extendedProperty of this.extendedProperties) {\r\n                group[extendedProperty.name] = new FormControl('');\r\n            }\r\n            this._formGroup = new FormGroup(group);\r\n            if (this.pendingHandled == false) {\r\n                if (this.pendingValue != null) {\r\n                    this.setFormValue(this.pendingValue);\r\n                }\r\n                for (let pendingEvent of this.pendingOnChangeEvents) {\r\n                    this._formGroup.valueChanges.subscribe(data => {\r\n                        pendingEvent(data);\r\n                    });\r\n                }\r\n                if (this.pendingDisabledValue != null) {\r\n                    if (this.pendingDisabledValue == true) {\r\n                        this._formGroup.disable();\r\n                    }\r\n                    else {\r\n                        this._formGroup.enable();\r\n                    }\r\n                }\r\n                this.pendingHandled = true;\r\n            }\r\n        });\r\n    }\r\n    writeValue(value) {\r\n        if (this._formGroup) {\r\n            this.setFormValue(value);\r\n        }\r\n        else {\r\n            this.pendingValue = value;\r\n        }\r\n    }\r\n    registerOnChange(fn) {\r\n        if (this._formGroup) {\r\n            this._formGroup.valueChanges.subscribe(data => {\r\n                fn(data);\r\n            });\r\n        }\r\n        else {\r\n            this.pendingOnChangeEvents.push(fn);\r\n        }\r\n    }\r\n    registerOnTouched(fn) {\r\n    }\r\n    setDisabledState(isDisabled) {\r\n        if (this._formGroup) {\r\n            if (isDisabled) {\r\n                this._formGroup.disable();\r\n            }\r\n            else {\r\n                this._formGroup.enable();\r\n            }\r\n        }\r\n        else {\r\n            this.pendingDisabledValue = isDisabled;\r\n        }\r\n    }\r\n    getRows() {\r\n        const values = this.extendedProperties.map(x => x.rowOrder);\r\n        const distinct = [...new Set(values)];\r\n        return distinct.sort();\r\n    }\r\n    getRowExtendedProperties(rowOrder) {\r\n        return this.extendedProperties.filter(x => x.rowOrder == rowOrder);\r\n    }\r\n    setFormValue(value) {\r\n        let valueKeys = Object.keys(value);\r\n        for (let extendedProperty of this.extendedProperties) {\r\n            let propertyValue = null;\r\n            if (valueKeys.indexOf(extendedProperty.name) > -1) {\r\n                propertyValue = value[extendedProperty.name];\r\n                if (extendedProperty.valueSelectorType == 'DateTime') {\r\n                    propertyValue = new Date(propertyValue);\r\n                }\r\n            }\r\n            this._formGroup.controls[extendedProperty.name].setValue(propertyValue);\r\n        }\r\n    }\r\n};\r\n__decorate([\r\n    Input(),\r\n    __metadata(\"design:type\", String)\r\n], ExtendedPropertiesSectionComponent.prototype, \"entityName\", void 0);\r\n__decorate([\r\n    Input(),\r\n    __metadata(\"design:type\", String)\r\n], ExtendedPropertiesSectionComponent.prototype, \"sectionName\", void 0);\r\nExtendedPropertiesSectionComponent = ExtendedPropertiesSectionComponent_1 = __decorate([\r\n    Component({\r\n        selector: 'app-extended-properties-section',\r\n        template: `<div class=\"form-group col-xs-12\" *ngIf=\"extendedProperties!=null && extendedProperties.length>0\">\r\n    \r\n<p-panel  [style]='{\"padding\":\"20px 0px 20px 0px\"}' header=\"{{'extendedProperties.ExtendedProperties' | translate}}\" [toggleable]=\"true\">\r\n\r\n    \r\n    <div *ngIf=\"_formGroup\" [formGroup]=\"_formGroup\" class=\"mt-3\">\r\n        <div *ngFor=\"let rowOrder of rows\" class=\"row\">\r\n            <ng-container *ngFor=\"let extendedProperty of getRowExtendedProperties(rowOrder)\">\r\n                <div class=\"extendedProperty form-group col-xs-12 {{extendedProperty.cssClass}}\">\r\n                    <label class=\"extendedPropertyLabel\">\r\n                        {{extendedProperty.title}}\r\n                    </label>\r\n    \r\n                    <div class=\"extendedPropertyValueSelector\">\r\n                       \r\n                        <app-extended-property-valueSelector [parentFormGroup]=\"_formGroup\" [formControlName]=\"extendedProperty.name\"\r\n                            [valueSelectorType]=\"extendedProperty.valueSelectorType\"\r\n                            [configuration]=\"extendedProperty.valueSelectorConfiguration\"></app-extended-property-valueSelector>\r\n                       \r\n                           \r\n                    </div>\r\n    \r\n                </div>\r\n            </ng-container>\r\n        </div>\r\n    </div>\r\n   \r\n</p-panel> \r\n\r\n\r\n</div>\r\n\r\n\r\n<!--\r\n<pre>\r\n\r\n\r\n{{_formGroup.value|json}}\r\n</pre>\r\n\r\n-->`,\r\n        styles: [``],\r\n        providers: [{\r\n                provide: NG_VALUE_ACCESSOR,\r\n                useExisting: forwardRef(() => ExtendedPropertiesSectionComponent_1),\r\n                multi: true\r\n            }]\r\n    }),\r\n    __metadata(\"design:paramtypes\", [Router, UtilityService, ExtendedPropertiesService, ActivatedRoute])\r\n], ExtendedPropertiesSectionComponent);\r\nexport { ExtendedPropertiesSectionComponent };\r\n//# sourceMappingURL=extended-properties-section.component.js.map","map":{"version":3,"file":"extended-properties-section.component.js","sourceRoot":"","sources":["../../src/app/extended-properties-section/extended-properties-section.component.ts"],"names":[],"mappings":";;AAAA,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE,KAAK,EAAU,MAAM,eAAe,CAAC;AACrE,OAAO,EAAwB,WAAW,EAAE,SAAS,EAAE,iBAAiB,EAAE,MAAM,gBAAgB,CAAC;AACjG,OAAO,EAAE,cAAc,EAAE,MAAM,EAAE,MAAM,iBAAiB,CAAC;AACzD,OAAO,EAAE,yBAAyB,EAAE,MAAM,uCAAuC,CAAC;AAClF,OAAO,EAAE,cAAc,EAAE,MAAM,4BAA4B,CAAC;AAoD5D,IAAa,kCAAkC,0CAA/C,MAAa,kCAAkC;IA6C7C,YAAoB,MAAc,EAAS,cAA6B,EAAS,OAAkC,EAAU,cAA8B;QAAvI,WAAM,GAAN,MAAM,CAAQ;QAAS,mBAAc,GAAd,cAAc,CAAe;QAAS,YAAO,GAAP,OAAO,CAA2B;QAAU,mBAAc,GAAd,cAAc,CAAgB;QAL3J,0BAAqB,GAA6B,IAAI,KAAK,EAAwB,CAAC;QAGpF,mBAAc,GAAG,KAAK,CAAC;QAGnB,OAAO,CAAC,GAAG,CAAC,gDAAgD,CAAC,CAAC;IAClE,CAAC;IAhCD,IAAI,WAAW;QACb,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QAEhE,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QAClD,IAAI,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,EAAC;YACvB,OAAO,IAAI,CAAC,SAAS,CAAC;SACvB;aAAI;YACH,OAAO,IAAI,CAAC,cAAc,CAAC;SAC5B;IAGH,CAAC;IAED,IAAI,aAAa;QACf,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QAEhE,IAAI,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,EAAC;YACvB,OAAO,SAAS,CAAC;SAClB;aAAI;YACH,OAAO,cAAc,CAAC;SACvB;IAGH,CAAC;IAYD,QAAQ;QAGN,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;QACnB,IAAI,CAAC,cAAc,GAAG,CAAC,CAAC;QAExB,OAAO,CAAC,GAAG,CAAC,2CAA2C,CAAC,CAAC;QAEzD,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,WAAW,EAAC,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE;YAEjH,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;gBAC3C,IAAI,CAAC,CAAC,SAAS,GAAG,CAAC,CAAC,SAAS,EAAE;oBAC7B,OAAO,CAAC,CAAC,CAAC;iBACX;gBAED,IAAI,CAAC,CAAC,SAAS,GAAG,CAAC,CAAC,SAAS,EAAE;oBAC7B,OAAO,CAAC,CAAC,CAAC;iBACX;gBAED,OAAO,CAAC,CAAC;YACX,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;YAE3B,IAAI,KAAK,GAAQ,EAAE,CAAC;YAEpB,KAAK,IAAI,gBAAgB,IAAI,IAAI,CAAC,kBAAkB,EAAE;gBAEpD,KAAK,CAAC,gBAAgB,CAAC,IAAI,CAAC,GAAG,IAAI,WAAW,CAAC,EAAE,CAAC,CAAC;aAEpD;YAED,IAAI,CAAC,UAAU,GAAG,IAAI,SAAS,CAAC,KAAK,CAAC,CAAC;YAEvC,IAAI,IAAI,CAAC,cAAc,IAAI,KAAK,EAAE;gBAEhC,IAAI,IAAI,CAAC,YAAY,IAAI,IAAI,EAAE;oBAC7B,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;iBACtC;gBAED,KAAK,IAAI,YAAY,IAAI,IAAI,CAAC,qBAAqB,EAAE;oBACnD,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE;wBAC5C,YAAY,CAAC,IAAI,CAAC,CAAC;oBACrB,CAAC,CAAC,CAAC;iBACJ;gBAED,IAAI,IAAI,CAAC,oBAAoB,IAAI,IAAI,EAAE;oBACrC,IAAI,IAAI,CAAC,oBAAoB,IAAI,IAAI,EAAE;wBACrC,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC;qBAC3B;yBACI;wBACH,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC;qBAC1B;iBACF;gBAED,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;aAC5B;QACH,CAAC,CAAC,CAAC;IAGL,CAAC;IAED,UAAU,CAAC,KAAU;QAKnB,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;SAC1B;aAAM;YACL,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;SAC3B;IAEH,CAAC;IAED,gBAAgB,CAAC,EAAwB;QACvC,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE;gBAC5C,EAAE,CAAC,IAAI,CAAC,CAAC;YACX,CAAC,CAAC,CAAC;SACJ;aACI;YACH,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;SACrC;IACH,CAAC;IAED,iBAAiB,CAAC,EAAc;IAEhC,CAAC;IAED,gBAAgB,CAAC,UAAmB;QAClC,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,IAAI,UAAU,EAAE;gBACd,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC;aAC3B;iBACI;gBACH,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC;aAC1B;SACF;aACI;YACH,IAAI,CAAC,oBAAoB,GAAG,UAAU,CAAC;SACxC;IACH,CAAC;IAED,OAAO;QACL,MAAM,MAAM,GAAG,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QAC5D,MAAM,QAAQ,GAAG,CAAC,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;QACtC,OAAO,QAAQ,CAAC,IAAI,EAAE,CAAC;IACzB,CAAC;IAED,wBAAwB,CAAC,QAAgB;QACvC,OAAO,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,QAAQ,IAAI,QAAQ,CAAC,CAAC;IACrE,CAAC;IAED,YAAY,CAAC,KAAU;QAGrB,IAAI,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAEnC,KAAK,IAAI,gBAAgB,IAAI,IAAI,CAAC,kBAAkB,EAAE;YACpD,IAAI,aAAa,GAAG,IAAI,CAAC;YAEzB,IAAI,SAAS,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE;gBACjD,aAAa,GAAG,KAAK,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;gBAG7C,IAAG,gBAAgB,CAAC,iBAAiB,IAAE,UAAU,EAAC;oBAChD,aAAa,GAAC,IAAI,IAAI,CAAC,aAAa,CAAC,CAAC;iBACvC;aAEF;YAED,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;SACzE;IAEH,CAAC;CAEF,CAAA;AAzLC;IADC,KAAK,EAAE;;sEACW;AAGnB;IADC,KAAK,EAAE;;uEACY;AALT,kCAAkC;IAlD9C,SAAS,CAAC;QACT,QAAQ,EAAE,iCAAiC;QAC3C,QAAQ,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAwCR;QACF,MAAM,EAAE,CAAC,EAAE,CAAC;QACZ,SAAS,EAAE,CAAC;gBACV,OAAO,EAAE,iBAAiB;gBAC1B,WAAW,EAAE,UAAU,CAAC,GAAG,EAAE,CAAC,oCAAkC,CAAC;gBACjE,KAAK,EAAE,IAAI;aACZ,CAAC;KACH,CAAC;qCA8C4B,MAAM,EAAwB,cAAc,EAAkB,yBAAyB,EAA0B,cAAc;GA7ChJ,kCAAkC,CA2L9C;SA3LY,kCAAkC"}}
